syntax = "v1"

info (
    title: "IM服务"
    desc: "即时通讯服务"
    author: "ZaiNeng"
    email: "2878428463@qq.com"
)

type (
    Message {
        Id int64 `json:"id"`
        SenderId int64 `json:"senderId"`
        ReceiverId int64 `json:"receiverId"` 
        Content string `json:"content"`
        Type int32 `json:"type"` // 1:文本 2:图片 3:语音 4:视频
        CreateTime int64 `json:"createTime"`
    }

    SendMessageReq {
        ReceiverId int64 `json:"receiverId"`
        Content string `json:"content"`
        Type int32 `json:"type"`
    }

    SendMessageResp {
        MessageId int64 `json:"messageId"`
    }

    GetMessageListReq {
        ReceiverId int64 `json:"receiverId"`
        LastMessageId int64 `json:"lastMessageId,optional"` // 上一页最后一条消息ID
        Size int32 `json:"size,optional,default=20"`
    }

    GetMessageListResp {
        Messages []Message `json:"messages"`
        HasMore bool `json:"hasMore"`
    }
)

@server(
    prefix: capi/im
    group: message
    middleware: Auth
)
service im {
    @doc "发��消息"
    @handler sendMessage
    post /message/send (SendMessageReq) returns (SendMessageResp)
    
    @doc "获取消息列表"
    @handler getMessageList
    post /message/list (GetMessageListReq) returns (GetMessageListResp)
} 